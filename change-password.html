<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Password - VUT iEnabler</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <div class="logo-section">
                <img src="images/logo.png" alt="VUT Logo" class="header-logo">
                <span class="system-name">iEnabler</span>
            </div>
            <nav class="header-nav">
                <a href="dashboard.html">Dashboard</a>
                <a href="schedule.html">Class Schedules</a>
                <a href="index.html">Log Out</a>
            </nav>
        </div>
        <div class="accent-stripe"></div>
    </header>

    <div class="page-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="images/logo.png" alt="VUT Logo">
                <h3>iEnabler</h3>
                <p id="sidebarStudentName">Student Name</p>
                <p id="sidebarStudentNumber" class="student-number">Loading...</p>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h4>MY ACADEMICS</h4>
                    <a href="program-of-study.html">Individual Program of Study</a>
                    <a href="enrolled-classes.html">Enrolled Classes</a>
                    <a href="schedule.html">Class Schedule</a>
                    <a href="grades.html">Grades</a>
                </div>

                <div class="nav-section">
                    <h4>MY ACCOUNT</h4>
                    <a href="google-account.html">Google Account</a>
                    <a href="profile.html">Student Information</a>
                    <a href="change-password.html" class="active">Change Password</a>
                    <a href="hold-orders.html">Hold Orders</a>
                </div>

                <div class="nav-section">
                    <h4>BROWSE</h4>
                    <a href="browse-schedule.html">Schedule of Classes</a>
                    <a href="degree-curricula.html">Degree Curricula</a>
                </div>

                <div class="nav-section">
                    <h4>FORMS</h4>
                    <a href="tuition-receipt.html">Tuition Receipt</a>
                    <a href="change-program.html">Change Degree Program Form</a>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="content-header">
                <h1>Change Password</h1>
                <p class="subtitle">MY ACCOUNT</p>
            </div>

            <div class="content-card">
                <form id="changePasswordForm" class="form-layout">
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label for="currentPin">Current PIN:</label>
                            <input type="password" id="currentPin" name="currentPin" maxlength="5" required>
                            <small>Enter your current 5-digit PIN</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label for="newPin">New PIN:</label>
                            <input type="password" id="newPin" name="newPin" maxlength="5" required>
                            <small>Enter a new 5-digit PIN (must not start with 0)</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label for="confirmPin">Confirm New PIN:</label>
                            <input type="password" id="confirmPin" name="confirmPin" maxlength="5" required>
                            <small>Re-enter your new PIN</small>
                        </div>
                    </div>

                    <div id="passwordMessage" class="message" style="display: none;"></div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Change Password</button>
                        <button type="button" class="btn-secondary" onclick="window.location.href='dashboard.html'">Cancel</button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>iEnabler</h4>
                <p>Vaal Integrated Student Information System</p>
            </div>
            <div class="footer-links">
                <a href="#">Terms & Conditions</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Contact Us</a>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Load student info
        const currentStudent = JSON.parse(localStorage.getItem('vut_current_student'));
        if (!currentStudent) {
            window.location.href = 'index.html';
        } else {
            document.getElementById('sidebarStudentName').textContent = currentStudent.name;
            document.getElementById('sidebarStudentNumber').textContent = currentStudent.studentNumber;
        }

        // Handle password change
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentPin = document.getElementById('currentPin').value;
            const newPin = document.getElementById('newPin').value;
            const confirmPin = document.getElementById('confirmPin').value;
            const messageDiv = document.getElementById('passwordMessage');
            
            // Validation
            if (!/^\d{5}$/.test(newPin)) {
                messageDiv.className = 'message error';
                messageDiv.textContent = 'New PIN must be exactly 5 digits.';
                messageDiv.style.display = 'block';
                return;
            }
            
            if (newPin.startsWith('0')) {
                messageDiv.className = 'message error';
                messageDiv.textContent = 'PIN cannot start with 0.';
                messageDiv.style.display = 'block';
                return;
            }
            
            if (newPin !== confirmPin) {
                messageDiv.className = 'message error';
                messageDiv.textContent = 'New PIN and confirmation do not match.';
                messageDiv.style.display = 'block';
                return;
            }
            
            // Get students from storage
            const students = JSON.parse(localStorage.getItem('vut_students') || '[]');
            const studentIndex = students.findIndex(s => s.studentNumber === currentStudent.studentNumber);
            
            if (studentIndex === -1 || students[studentIndex].pin !== currentPin) {
                messageDiv.className = 'message error';
                messageDiv.textContent = 'Current PIN is incorrect.';
                messageDiv.style.display = 'block';
                return;
            }
            
            // Update password
            students[studentIndex].pin = newPin;
            students[studentIndex].tempPin = false;
            localStorage.setItem('vut_students', JSON.stringify(students));
            
            // Update current student
            currentStudent.pin = newPin;
            localStorage.setItem('vut_current_student', JSON.stringify(currentStudent));
            
            messageDiv.className = 'message success';
            messageDiv.textContent = 'Password changed successfully!';
            messageDiv.style.display = 'block';
            
            // Clear form
            document.getElementById('changePasswordForm').reset();
            
            // Redirect after 2 seconds
            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 2000);
        });
    </script>
</body>
</html>
